project:
  name: "fagus_npe_production_v7"
  seed: 42                       # Standard seed for production
  output_dir: "production_results"

observed:
  pooldata_rdata: "observed_data/Pooldata_demography.RData"
  pooldata_object: "filt.pooldata"
  groups_csv: "config/groups_6clusters.csv"
  target_cov: 20

simulation:
  slim_binary: "/home/j_morando/.local/bin/slim"
  slim_template: "templates/model.slim.tpl"
  trees_tmpdir: "/dev/shm"
  
  pop_order: ['p1', 'p3', 'p4', 'p5', 'p7', 'p8']
  
  # ---- Adaptive scaling (Matched to POD) ----
  max_scale_factor: 100
  safe_min_diploids: 50

  # ---- Timeline (Matched to POD) ----
  burnin: 2000
  gens: 12000
  genome_length: 2e7
  recombination_rate: 1e-8
  
  mutation_overlay:
    enable: true
    mu: 7.77e-9
    model: "binary"
    target_snps: null
  
  samples_per_group_haploid: 20

priors:
  times:
    T_BG01:      {min:  100, max: 8000}
    T_CORE:      {min:  200, max: 8500}
    T_SOUTH_LOW: {min:  300, max: 9000}
    T_SOUTH_MID: {min:  500, max: 9500}
    T_EAST:      {min:  400, max: 9500}
    T_INT:       {min:  500, max: 9500}
    T_CENTRAL:   {min:  600, max: 9700}
    T_PYRENEES:  {min:  700, max: 9900}
  
  sizes:
    # FIXED: Ghost/ancestral populations (Matched to POD)
    N0:          {dist: fixed, value: 10000}
    N_CORE:      {dist: fixed, value: 10000}
    
    # FREE: Sampled populations + N_INT
    N_BG01:      {dist: loguniform, min:  2500, max: 150000}
    N_SOUTH_LOW: {dist: loguniform, min:  2500, max: 150000}
    N_SOUTH_MID: {dist: loguniform, min:  2500, max: 150000}
    N_EAST:      {dist: loguniform, min:  2500, max: 150000}
    N_INT:       {dist: loguniform, min:  2500, max: 150000}
    N_CENTRAL:   {dist: loguniform, min:  2500, max: 150000}
    N_PYRENEES:  {dist: loguniform, min:  2500, max: 150000}
  
  demography_extras:
    enable: false
    bottleneck:
      mode: per_population
      time_fraction: {dist: uniform, min: 0.2, max: 0.6}
      size_fraction: {dist: loguniform, min: 0.05, max: 0.3}
      duration_gens: {dist: discrete_uniform, min: 10, max: 100}
    expansion:
      enable: false
    migration:
      enable: false

npe:
  # ---- Simulation budget ----
  n_sims: 100000              # Validated 100k count

  # ---- Dataloader / training ----
  batch_size: 1024            # Validated batch size
  num_workers: 60            

  # ---- Model Capacity (Explicitly defining standard 100k architecture) ----
  # While not in your snippet, these are the recommended robust defaults
  # for a 100k run to avoid under/over-fitting:
  hidden_sizes: [256, 256]    
  flow:
    hidden_sizes: [256, 256]
    num_layers: 5
    num_bins: 8
    tail_bound: 3.0

  # ---- Optimisation ----
  lr: 0.0003                  
  weight_decay: 0.0004        # Matched to POD
  
  # ---- Regularization ----
  dropout: 0.1                # Matched to POD (Critical for precision)

  # ---- Training schedule ----
  max_epochs: 200
  early_stop_patience: 30

  # ---- Normalisation ----
  standardize_x: true
  standardize_theta: true

  # ---- Posterior sampling ----
  n_posterior_samples: 20000  # Increased for smooth production densities
  val_frac: 0.1
  max_val: 2000
  min_val: 50
